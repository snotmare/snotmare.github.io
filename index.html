<html>
<head>
<script>
	// https://stackoverflow.com/questions/46882550/how-to-save-a-jpg-image-video-captured-with-webcam-in-the-local-hard-drive-with
	const vid = document.querySelector('video');
	
	const options = {
		video: true,
		facingMode: 'environment'
	};
	
	navigator.mediaDevices.getUserMedia(options) // request cam
		.then(stream => {
			vid.srcObject = stream; // don't use createObjectURL(MediaStream)
			return vid.play(); // returns a Promise
		})
		.then(()=>{ // enable the button
			const btn = document.querySelector('button');
			btn.disabled = false;
			btn.onclick = e => {
				takeASnap().then(download);
			};
		})
		.catch(e => logError(e));

	function takeASnap(){
		const canvas = document.createElement('canvas'); // create a canvas
		const ctx = canvas.getContext('2d'); // get its context
		canvas.width = vid.videoWidth; // set its size to the one of the video
		canvas.height = vid.videoHeight;
		ctx.drawImage(vid, 0,0); // the video
		
		return new Promise((res, rej)=>{
			canvas.toBlob(res, 'image/jpeg'); // request a Blob from the canvas
		});
	}
	
	function download(blob){
		// uses the <a download> to download a Blob
		let a = document.createElement('a'); 
		a.href = URL.createObjectURL(blob);
		a.download = 'test.jpg';
		document.body.appendChild(a);
		a.click();
	}
	
	function logError(error) {
		document.getElementById('error').innerHTML = error;
	}
</script>

</head>

<body>
	<button>Save</button>
	<video id="vid"></video>
	<div id="error"></div>
</body>
</html>